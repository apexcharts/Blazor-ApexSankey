@page "/basic-sankey"

<PageTitle>Basic Sankey - Blazor-ApexSankey Demo</PageTitle>

<div class="demo-page">
    <h1>Basic Sankey</h1>
    <p class="description">A simple energy flow diagram showing the relationship between energy sources.</p>

    <div class="controls-panel">
        <h3>Interactive Controls</h3>
        <div class="controls-grid">
            <div class="control-group">
                <label>Node Width: @_nodeWidth px</label>
                <input type="range" min="5" max="40" @bind="_nodeWidth" @bind:event="oninput" @onchange="UpdateOptions" />
            </div>
            <div class="control-group">
                <label>Edge Opacity: @_edgeOpacity.ToString("F2")</label>
                <input type="range" min="0.1" max="1" step="0.05" @bind="_edgeOpacity" @bind:event="oninput" @onchange="UpdateOptions" />
            </div>
            <div class="control-group">
                <label>
                    <input type="checkbox" @bind="_enableToolbar" @bind:event="onchange" @onclick="UpdateOptions" />
                    Enable Toolbar
                </label>
            </div>
            <div class="control-group">
                <label>
                    <input type="checkbox" @bind="_edgeGradientFill" @bind:event="onchange" @onclick="UpdateOptions" />
                    Edge Gradient Fill
                </label>
            </div>
        </div>
    </div>

    <div class="chart-container">
        <ApexSankey Data="@_data"
                    Options="@_options"
                    OnNodeClick="@HandleNodeClick"
                    OnRender="@HandleRender"
                    Style="margin: 0 auto; width: 800px; height: 600px;" />
    </div>

    @if (!string.IsNullOrEmpty(_clickedNode))
    {
        <div class="event-log">
            <strong>Last clicked:</strong> @_clickedNode
        </div>
    }

    <div class="code-section">
        <h3>Code</h3>
        <pre><code>@_codeExample</code></pre>
    </div>
</div>

@code {
    private string? _clickedNode;
    
    // interactive control values
    private int _nodeWidth = 20;
    private double _edgeOpacity = 0.4;
    private bool _enableToolbar = true;
    private bool _edgeGradientFill = true;

    private SankeyData _data = new()
    {
        Nodes = new List<SankeyNode>
        {
            new() { Id = "Oil", Title = "Oil" },
            new() { Id = "Natural Gas", Title = "Natural Gas" },
            new() { Id = "Coal", Title = "Coal" },
            new() { Id = "Fossil Fuels", Title = "Fossil Fuels" },
            new() { Id = "Electricity", Title = "Electricity" },
            new() { Id = "Energy", Title = "Energy" }
        },
        Edges = new List<SankeyEdge>
        {
            new() { Source = "Oil", Target = "Fossil Fuels", Value = 15 },
            new() { Source = "Natural Gas", Target = "Fossil Fuels", Value = 20 },
            new() { Source = "Coal", Target = "Fossil Fuels", Value = 25 },
            new() { Source = "Coal", Target = "Electricity", Value = 25 },
            new() { Source = "Fossil Fuels", Target = "Energy", Value = 60 },
            new() { Source = "Electricity", Target = "Energy", Value = 25 }
        }
    };

    private SankeyOptions _options = new()
    {
        NodeWidth = 20,
        FontFamily = "Quicksand, sans-serif",
        FontWeight = "600",
        Height = "600",
        EnableToolbar = true,
        EdgeOpacity = 0.4,
        EdgeGradientFill = true
    };

    private void UpdateOptions()
    {
        _options = new SankeyOptions
        {
            NodeWidth = _nodeWidth,
            FontFamily = "Quicksand, sans-serif",
            FontWeight = "600",
            Height = "600",
            EnableToolbar = _enableToolbar,
            EdgeOpacity = _edgeOpacity,
            EdgeGradientFill = _edgeGradientFill
        };
    }

    private void HandleNodeClick(NodeClickEventArgs args)
    {
        _clickedNode = $"{args.Node.Title} (ID: {args.Node.Id})";
        StateHasChanged();
    }

    private void HandleRender()
    {
        Console.WriteLine("Chart rendered successfully");
    }

    private string _codeExample = @"var data = new SankeyData
{
    Nodes = new List<SankeyNode>
    {
        new() { Id = ""Oil"", Title = ""Oil"" },
        new() { Id = ""Natural Gas"", Title = ""Natural Gas"" },
        new() { Id = ""Coal"", Title = ""Coal"" },
        new() { Id = ""Fossil Fuels"", Title = ""Fossil Fuels"" },
        new() { Id = ""Electricity"", Title = ""Electricity"" },
        new() { Id = ""Energy"", Title = ""Energy"" }
    },
    Edges = new List<SankeyEdge>
    {
        new() { Source = ""Oil"", Target = ""Fossil Fuels"", Value = 15 },
        new() { Source = ""Natural Gas"", Target = ""Fossil Fuels"", Value = 20 },
        new() { Source = ""Coal"", Target = ""Fossil Fuels"", Value = 25 },
        new() { Source = ""Coal"", Target = ""Electricity"", Value = 25 },
        new() { Source = ""Fossil Fuels"", Target = ""Energy"", Value = 60 },
        new() { Source = ""Electricity"", Target = ""Energy"", Value = 25 }
    }
};

var options = new SankeyOptions
{
    NodeWidth = 20,
    FontFamily = ""Quicksand, sans-serif"",
    FontWeight = ""600"",
    Height = ""600"",
    EnableToolbar = true
};";
}

<style>
    .demo-page {
        max-width: 900px;
        margin: 0 auto;
    }

    h1 {
        font-size: 1.75rem;
        color: #1a1a2e;
        margin-bottom: 8px;
    }

    .description {
        color: #666;
        margin-bottom: 24px;
    }

    .controls-panel {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        margin-bottom: 16px;
    }

    .controls-panel h3 {
        font-size: 0.9rem;
        color: #1a1a2e;
        margin-bottom: 16px;
    }

    .controls-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }

    .control-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .control-group label {
        font-size: 0.85rem;
        color: #444;
    }

    .control-group input[type="range"] {
        width: 100%;
        cursor: pointer;
    }

    .control-group input[type="checkbox"] {
        margin-right: 8px;
    }

    .chart-container {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        margin-bottom: 24px;
    }

    .event-log {
        background: #e8f4fd;
        border: 1px solid #b8daff;
        border-radius: 4px;
        padding: 12px 16px;
        margin-bottom: 24px;
        font-size: 0.9rem;
    }

    .code-section {
        background: #1a1a2e;
        border-radius: 8px;
        padding: 20px;
        color: #fff;
    }

    .code-section h3 {
        font-size: 0.85rem;
        margin-bottom: 12px;
        opacity: 0.7;
    }

    .code-section pre {
        margin: 0;
        overflow-x: auto;
    }

    .code-section code {
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.8rem;
        line-height: 1.5;
    }
</style>
